<!doctype html>
<!--
__     __      __     _ _                                 _    _
\ \   / /     / _|   | | |                               | |  | |
 \ \_/ /__   | |_ ___| | | _____      __   __ _  ___  ___| | _| |
  \   / _ \  |  _/ _ \ | |/ _ \ \ /\ / /  / _` |/ _ \/ _ \ |/ / |
   | | (_) | | ||  __/ | | (_) \ V  V /  | (_| |  __/  __/   <|_|
   |_|\___/  |_| \___|_|_|\___/ \_/\_/    \__, |\___|\___|_|\_(_)
                                           __/ |
                                          |___/
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Timer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <style>
    @import url('http://fonts.googleapis.com/css?family=Squada+One|Syncopate');
    html, body {margin: 0; padding: 0;}
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {-webkit-appearance: none; margin: 0; }
    input {font-family: 'Squada One', cursive; font-size: 35em; border: 0; color: #f15b47; outline: none; width: 600px; text-align: center }
    ul {list-style-type: none; text-align: center; margin: 0; padding: 0; }
    li {display: inline-block; }
    p {font-family: 'Syncopate', sans-serif; text-transform: uppercase; font-size: 3em; margin: 0; color: #ccc; text-align: center; }
    section {background: #eee; margin-top: 1em; }
    h4 {font-family: 'Syncopate', sans-serif; margin: 0; color: #444; text-align: center; padding: .5em; line-height: 2em;}
    code {font-weight: normal; font-size: 1.2em; border: 1px solid #999; border-radius: .3em; padding: .2em;}
    progress {background-color: #eee; border: 0; width: 100%; height: 2em; display:none; margin-top: 1em;}
    progress::-webkit-progress-bar {background-color: #eee; }
    progress::-webkit-progress-value {background: #f15b47; }
    progress::-moz-progress-bar {background: #f15b47; }
    @media only screen and (max-width: 1220px) {input {font-size: 30em; width: 500px;} p {font-size: 2.5em;} }
    @media only screen and (max-width: 1020px) {input {font-size: 20em; width: 400px;} p {font-size: 2em;} }
    @media only screen and (max-width: 810px) {input {font-size: 15em; width: 300px;} p {font-size: 1.5em;} }
    @media only screen and (max-width: 620px) {input {font-size: 7em; width: 100px;} p, h4 {font-size: 1em;} }
    @media only screen and (max-width: 420px) {input {font-size: 4em; width: 60px;} p, h4 {font-size: .8em;} }
  </style>
</head>
<body>

<ul>
  <li><input type="number" min=0 max=60 id="minutes" value=05><p>minutes</p></li>
  <li><input type="number" min=0 max=60 id="seconds" value=00><p>seconds</p></li>
</ul>

<section id="info">
  <h4><code>spacebar</code> / <code>click</code> / <code>tap</code> to play / pause</h4>
  <h4><code>esc</code> / <code>double click</code> / <code>double touch</code> to reset</h4>
</section>

<progress value=0 max=100 id="progress"></progress>

<script>
console.log('%c Yo fellow geek!', 'background: #f15b47; color: #fff');

(function () {
  var play = false;
  var intervalID;
  var minElement = document.getElementById('minutes');
  var secElement = document.getElementById('seconds');
  var infoElement = document.getElementById('info');
  var progressElement = document.getElementById('progress');
  var minValue = sanitize(minElement.value);
  var secValue = sanitize(secElement.value);
  var totalSeconds = minValue*60 + secValue;
  var currentSeconds = 0;
  var singleTap = false;
  var doubleTap = false;

  minElement.addEventListener('blur', setTimer);
  secElement.addEventListener('blur', setTimer);

  function setTimer() {
    minValue = sanitize(minElement.value);
    secValue = sanitize(secElement.value);
    totalSeconds = secValue + 60 * minValue;
    currentSeconds = 0;
  }

  function sanitize(input) {
    return Math.abs(parseInt(input, 10));
  }

  function make2Digits(input) {
    return ('0' + input).slice(-2)
  }

  function startCountdown(min, sec) {
     intervalID = setInterval(function() {

      if(--sec < 0) {
        sec += 60;

        if(--min < 0) {
          endCountdown();
          clearInterval(intervalID);
          return;
        }
      }
      minElement.value = ('0' + min).slice(-2);
      secElement.value = ('0' + sec).slice(-2);


      currentSeconds++;
      progressElement.value = Math.ceil(currentSeconds/totalSeconds*100);

    }, 1000);
  }

  function endCountdown() {
    infoElement.style.display = 'block';
    progressElement.style.display = 'none';
  }

  function togglePausePlay() {
    if(play) {
      play = false;
      clearInterval(intervalID);
    } else {
      minElement.value = make2Digits( sanitize(minElement.value) );
      secElement.value = make2Digits( sanitize(secElement.value) );
      startCountdown(minElement.value, secElement.value);
      play = true;
      infoElement.style.display = 'none';
      progressElement.style.display = 'block';
    }
  }

  function resetTimer() {
    clearInterval(intervalID);
    minElement.value = make2Digits(minValue);
    secElement.value = make2Digits(secValue);
    infoElement.style.display = 'block';
    progressElement.style.display = 'none';
    progressElement.value = 0;
    currentSeconds = 0;
  }

  window.addEventListener('keydown', function(e){
    if(e.keyCode === 32) { // when SPACE is pressed
      e.preventDefault();
      togglePausePlay();
    } else if(e.keyCode === 27) { // when ESC is pressed
      resetTimer()
    }
  });

  window.addEventListener('click', function(e){
    if(e.toElement.tagName !== 'INPUT') togglePausePlay();
  });

  window.addEventListener('dblclick', function(e){
    if(e.toElement.tagName !== 'INPUT') resetTimer();
  });

  window.addEventListener('touchend', function(e){
    if(e.srcElement.tagName !== 'INPUT') {
      if(!singleTap) {
        singleTap = true;
        var timerID = setTimeout(function() {
          singleTap = false;
          if(doubleTap) resetTimer();
          else togglePausePlay();
          doubleTap = false;
        }, 400);
      } else {
        doubleTap = true;
      }
    }

  });

})();
</script>

</body>
</html>
